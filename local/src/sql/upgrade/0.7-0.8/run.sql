spool upgrade-0.7-0.8.log
set define off

PROMPT insert-into-release.sql
@@../../basic/insert-into-release.sql

WHENEVER SQLERROR EXIT FAILURE

drop table content_provider_name cascade constraints;

ALTER TABLE CONTENT_PROVIDER_CONSUMER MODIFY (
 CONTENT_PROVIDER_ID NOT NULL,
 EHUB_CONSUMER_ID NOT NULL);

alter table CONTENT_P_FORMAT_LANGUAGE
rename to language;

alter table language rename column language to id;

ALTER TABLE CONTENT_P_FORMAT_TEXT_BUNDLE  rename column LANGUAGE to language_id;
ALTER TABLE CONTENT_P_FORMAT_TEXT_BUNDLE DROP CONSTRAINT FK_CONT_P_F_T_B_CONT_P_F_L;
ALTER TABLE CONTENT_P_FORMAT_TEXT_BUNDLE DROP CONSTRAINT UK_CONTENT_P_FORMAT_TEXT_BUNDL;
ALTER TABLE CONTENT_P_FORMAT_TEXT_BUNDLE ADD CONSTRAINT FK_CONTENT_P_F_T_B_LANGUAGE FOREIGN KEY (LANGUAGE_ID) REFERENCES LANGUAGE(ID);
ALTER TABLE CONTENT_P_FORMAT_TEXT_BUNDLE ADD CONSTRAINT UK_CONTENT_P_FORMAT_TEXT_BUNDL UNIQUE (CONTENT_P_FORMAT_DECORATION_ID,LANGUAGE_ID);

ALTER TABLE EHUB_CONSUMER ADD (DEFAULT_LANGUAGE_ID VARCHAR2(255 CHAR));
update ehub_consumer set default_language_id='sv';
commit;
ALTER TABLE EHUB_CONSUMER MODIFY (default_language_id not null);
ALTER TABLE EHUB_CONSUMER ADD CONSTRAINT FK_EHUB_CONSUMER_LANGUAGE FOREIGN KEY (DEFAULT_LANGUAGE_ID) REFERENCES LANGUAGE(ID);

CREATE TABLE ERROR_CAUSE_ARGUMENT_VALUE(
  ID NUMBER NOT NULL,
  CREATE_DATETIME TIMESTAMP NOT NULL,
  MODIFY_DATETIME TIMESTAMP NOT NULL,
  TYPE VARCHAR2(255 CHAR),
  CONSTRAINT PK_ERROR_CAUSE_ARGUMENT_VALUE PRIMARY KEY (ID) ENABLE,
  CONSTRAINT UK_ERROR_CAUSE_ARGUMENT_VALUE UNIQUE (TYPE) ENABLE
);

CREATE TABLE ERROR_C_A_V_TEXT_BUNDLE(
  ID NUMBER NOT NULL,
  ERROR_CAUSE_ARGUMENT_VALUE_ID NUMBER NOT NULL,
  TEXT VARCHAR2(255 CHAR),
  LANGUAGE_ID VARCHAR2(255 CHAR) NOT NULL,
  CREATE_DATETIME TIMESTAMP NOT NULL,
  MODIFY_DATETIME TIMESTAMP NOT NULL,
  CONSTRAINT PK_ERROR_C_A_V_TEXT_BUNDLE PRIMARY KEY (ERROR_CAUSE_ARGUMENT_VALUE_ID,LANGUAGE_ID) ENABLE,
  CONSTRAINT FK_ERROR_C_A_V_T_B_LANGUAGE FOREIGN KEY ("LANGUAGE_ID") REFERENCES LANGUAGE (ID),
  CONSTRAINT FK_ERROR_C_A_V_T_B_ERROR_C_A_V FOREIGN KEY (ERROR_CAUSE_ARGUMENT_VALUE_ID)
  REFERENCES ERROR_CAUSE_ARGUMENT_VALUE(ID)
);

create table CONTENT_PROVIDER_ROUTING_RULE (
  ID NUMBER NOT NULL,
  CREATE_DATETIME timestamp not null,
  MODIFY_DATETIME timestamp not null,
  SOURCE varchar2(255 char) not null,
  TARGET varchar2(255 char) not null,
  CONSTRAINT PK_CONTENT_P_ROUTING_RULE PRIMARY KEY (ID) ENABLE,
  CONSTRAINT UK_CONTENT_P_ROUTING_RULE UNIQUE (SOURCE) ENABLE
);

insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (1,'BORROWER_LIMIT_REACHED', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (2,'INACTIVE_LOAN', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (3,'LIBRARY_LIMIT_REACHED', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (4,'MAX_NO_OF_DOWNLOADS_FOR_PRODUCT_REACHED', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (5,'MISSING_CONTENT_IN_LOAN', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (6,'PRODUCT_INACTIVE', systimestamp, systimestamp);
insert into ERROR_CAUSE_ARGUMENT_VALUE (id, type, CREATE_DATETIME,MODIFY_DATETIME) VALUES (7,'PRODUCT_UNAVAILABLE', systimestamp, systimestamp);

insert into CONTENT_PROVIDER(id, NAME, CREATE_DATETIME, MODIFY_DATETIME) VALUES(6, 'ELIB3', systimestamp, systimestamp);
insert into CONTENT_PROVIDER_PROPERTY (CONTENT_PROVIDER_ID, PROPERTY_KEY, PROPERTY_VALUE) VALUES (6, 'API_BASE_URL', 'https://webservices.elib.se/library/v3.0');

insert into CONTENT_P_FORMAT_DECORATION (ID,CONTENT_DISPOSITION,FORMAT_ID,CONTENT_PROVIDER_ID,PLAYER_WIDTH,PLAYER_HEIGHT, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1401,'STREAMING','4002', 6, 600, 215, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_DECORATION (ID,CONTENT_DISPOSITION,FORMAT_ID,CONTENT_PROVIDER_ID,PLAYER_WIDTH,PLAYER_HEIGHT, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1402,'STREAMING','4101', 6, 0, 0, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_DECORATION (ID,CONTENT_DISPOSITION,FORMAT_ID,CONTENT_PROVIDER_ID,PLAYER_WIDTH,PLAYER_HEIGHT, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1403,'DOWNLOADABLE','4103', 6, 0, 0, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_DECORATION (ID,CONTENT_DISPOSITION,FORMAT_ID,CONTENT_PROVIDER_ID,PLAYER_WIDTH,PLAYER_HEIGHT, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1404,'DOWNLOADABLE','4104', 6, 0, 0, systimestamp, systimestamp);

insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4401,'E-audiobook in streaming Flash','en','Audiobook (Flash)', 1401, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4402,'E-ljudbok i formatet Flash','sv','Ljudbok (Flash)', 1401, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4403,'E-book in EPUB delivered using HTML5','en','EPUB (Online)', 1402, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4404,'E-bok i formatet EPUB levererad med HTML5','sv','EPUB (Online)', 1402, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4405,'E-book in PDF distributed with license encryption','en','PDF', 1403, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4406,'E-bok i formatet PDF distribuerad med licenskryptering','sv','PDF', 1403, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4407,'E-book in EPUB distributed with license encryption','en','EPUB (Offline)', 1404, systimestamp, systimestamp);
insert into CONTENT_P_FORMAT_TEXT_BUNDLE (ID,DESCRIPTION,LANGUAGE_ID,NAME,CONTENT_P_FORMAT_DECORATION_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (4408,'E-bok i formatet EPUB distribuerad med licenskryptering','sv','EPUB (Offline)', 1404, systimestamp, systimestamp);

insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1001, 1, 'You have reached your limit when it comes to the number of e-media loans', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1002, 1, 'Du har n' ||CHR(229 USING NCHAR_CS)|| 'tt din gr'||CHR(228 USING NCHAR_CS)||'ns n'||CHR(228 USING NCHAR_CS)||'r det g'||CHR(228 USING NCHAR_CS)||'ller l'||CHR(229 USING NCHAR_CS)||'n av e-b'||CHR(246 USING NCHAR_CS)||'cker', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1003, 2, 'The loan is no longer active', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1004, 2, 'L'||CHR(229 USING NCHAR_CS)||'net '||CHR(228 USING NCHAR_CS)||'r inte aktivt l'||CHR(228 USING NCHAR_CS)||'ngre', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1005, 3, 'The library has reached its limit when it comes to the number of e-media loans', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1006, 3, 'Biblioteket har n'||CHR(229 USING NCHAR_CS)||'tt sin gr'||CHR(228 USING NCHAR_CS)||'ns n'||CHR(228 USING NCHAR_CS)||'r det g'||CHR(228 USING NCHAR_CS)||'ller l'||CHR(229 USING NCHAR_CS)||'n av e-b'||CHR(246 USING NCHAR_CS)||'cker', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1007, 4, 'The maximum number of downloads has been reached for this book', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1008, 4, 'Max antal nedladdningar har n'||CHR(229 USING NCHAR_CS)||'tts f'||CHR(246 USING NCHAR_CS)||'r den h'||CHR(228 USING NCHAR_CS)||'r boken', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1009, 5, 'The loan does not contain any content', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1010, 5, 'L'||CHR(229 USING NCHAR_CS)||'net saknar inneh'||CHR(229 USING NCHAR_CS)||'ll', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1011, 6, 'The book is inactive and is therefore unavailable to loan', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1012, 6, 'Boken '||CHR(228 USING NCHAR_CS)||'r inaktiv och '||CHR(228 USING NCHAR_CS)||'r d'||CHR(228 USING NCHAR_CS)||'rf'||CHR(246 USING NCHAR_CS)||'r inte tillg'||CHR(228 USING NCHAR_CS)||'nglig f'||CHR(246 USING NCHAR_CS)||'r utl'||CHR(229 USING NCHAR_CS)||'n', 'sv', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1013, 7, 'The book is unavailable to loan when it lacks a valid business model ', 'en', systimestamp, systimestamp);
insert into ERROR_C_A_V_TEXT_BUNDLE (ID, ERROR_CAUSE_ARGUMENT_VALUE_ID, TEXT, LANGUAGE_ID, CREATE_DATETIME, MODIFY_DATETIME) VALUES (1014, 7, 'Boken '||CHR(228 USING NCHAR_CS)||'r inte tillg'||CHR(228 USING NCHAR_CS)||'nglig f'||CHR(246 USING NCHAR_CS)||'r utl'||CHR(229 USING NCHAR_CS)||'n d'||CHR(229 USING NCHAR_CS)||' den saknar en giltig aff'||CHR(228 USING NCHAR_CS)||'rsmodell', 'sv', systimestamp, systimestamp);

insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (1, systimestamp, systimestamp, 'ELIB', 'ELIB');
insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (2, systimestamp, systimestamp, 'ELIBU', 'ELIBU');
insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (3, systimestamp, systimestamp, 'PUBLIT', 'PUBLIT');
insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (4, systimestamp, systimestamp, 'ASKEWS', 'ASKEWS');
insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (5, systimestamp, systimestamp, 'OVERDRIVE', 'OVERDRIVE');
insert into CONTENT_PROVIDER_ROUTING_RULE (ID, CREATE_DATETIME, MODIFY_DATETIME, SOURCE, TARGET) values (6, systimestamp, systimestamp, 'ELIB3', 'ELIB3');

commit;

PROMPT rename-constraints.sql
@@../../basic/rename-constraints.sql

PROMPT create-fk-indexes.sql
@@../../basic/create-fk-indexes.sql

spool off
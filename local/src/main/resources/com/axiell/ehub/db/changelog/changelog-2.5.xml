<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <property name="now" value="systimestamp" dbms="oracle"/>

    <changeSet id="1" author="ehub">
        <createTable tableName="PLATFORM">
            <column name="id" type="int">
                <constraints primaryKey="true" nullable="false" primaryKeyName="PK_PLATFORM"/>
            </column>
            <column name="name" type="varchar2(255)">
                <constraints nullable="false"/>
            </column>
            <column name="modify_datetime" type="timestamp(6)">
                <constraints nullable="false"/>
            </column>
            <column name="create_datetime" type="timestamp(6)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <comment>Created table PLATFORM</comment>
    </changeSet>
    <changeSet  id="2" author="ehub">
        <addUniqueConstraint columnNames="name"
                             constraintName="UK_PLATFORM"
                             deferrable="true"
                             initiallyDeferred="false"
                             tableName="PLATFORM"/>
        <comment>Constraints for table PLATFORM</comment>
    </changeSet>
    <changeSet id="3" author="ehub">
        <createTable tableName="FORMAT_DECORATION_PLATFORM">
            <column name="platform_id" type="int">
                <constraints primaryKey="true" nullable="false" primaryKeyName="PK_FORMAT_DECORATION_PLATFORM"/>
            </column>
            <column name="content_p_format_decoration_id" type="int">
                <constraints primaryKey="true" nullable="false" primaryKeyName="PK_FORMAT_DECORATION_PLATFORM"/>
            </column>
        </createTable>
        <comment>Created table FORMAT_DECORATION_PLATFORM</comment>
    </changeSet>
    <changeSet id="4" author="ehub">
        <addForeignKeyConstraint baseColumnNames="platform_id"
                                 baseTableName="FORMAT_DECORATION_PLATFORM"
                                 constraintName="FK_F_D_P_PLATFORM"
                                 deferrable="true"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="PLATFORM"/>
        <addForeignKeyConstraint baseColumnNames="content_p_format_decoration_id"
                                 baseTableName="FORMAT_DECORATION_PLATFORM"
                                 constraintName="FK_F_D_P_CONTENT_P_F_D"
                                 deferrable="true"
                                 initiallyDeferred="false"
                                 onDelete="CASCADE"
                                 onUpdate="RESTRICT"
                                 referencedColumnNames="id"
                                 referencedTableName="CONTENT_P_FORMAT_DECORATION"/>
        <comment>Constraints for table FORMAT_DECORATION_PLATFORM</comment>
    </changeSet>
    <changeSet id="5" author="ehub">
        <insert tableName="PLATFORM">
            <column name="ID" value="1"/>
            <column name="NAME" value="ANDROID"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <insert tableName="PLATFORM">
            <column name="ID" value="2"/>
            <column name="NAME" value="IOS"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <insert tableName="PLATFORM">
            <column name="ID" value="3"/>
            <column name="NAME" value="PCMAC"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <comment>Base data for table PLATFORM</comment>
    </changeSet>
    <changeSet id="6" author="ehub">
        <dropColumn columnName="player_width" tableName="CONTENT_P_FORMAT_DECORATION"/>
        <dropColumn columnName="player_height" tableName="CONTENT_P_FORMAT_DECORATION"/>
        <comment>Drop columns player_width and player_height</comment>
    </changeSet>
    <changeSet id="7" author="ehub">
        <sql>INSERT INTO FORMAT_DECORATION_PLATFORM(PLATFORM_ID,CONTENT_P_FORMAT_DECORATION_ID) SELECT platform.id,  content_p_format_decoration.id FROM PLATFORM, CONTENT_P_FORMAT_DECORATION</sql>
        <comment>Initialize format platforms</comment>
    </changeSet>
    <changeSet id="8" author="ehub" >
        <addColumn tableName="CONTENT_PROVIDER">
            <column name="LOAN_PER_PRODUCT" type="number(1)"/>
        </addColumn>
        <update tableName="CONTENT_PROVIDER">
            <column name="LOAN_PER_PRODUCT" value="0"/>
        </update>
        <addNotNullConstraint columnName="LOAN_PER_PRODUCT" tableName="CONTENT_PROVIDER"/>
    </changeSet>
    <changeSet id="9" author="ehub">
        <renameColumn tableName="EHUB_LOAN" newColumnName="CONTENT_P_F_F_DECORATION_ID" oldColumnName="CONTENT_P_FORMAT_DECORATION_ID"/>
    </changeSet>
    <changeSet id="10" author="ehub" >
        <addColumn tableName="CONTENT_P_FORMAT_DECORATION">
            <column name="LOCKED" type="number(1)"/>
        </addColumn>
        <update tableName="CONTENT_P_FORMAT_DECORATION">
            <column name="LOCKED" value="0"/>
        </update>
        <addNotNullConstraint columnName="LOCKED" tableName="CONTENT_P_FORMAT_DECORATION"/>
    </changeSet>
    <changeSet id="11" author="ehub" dbms="oracle">
        <insert tableName="ERROR_CAUSE_ARGUMENT_VALUE">
            <column name="ID" value="17"/>
            <column name="TYPE" value="MISSING_EMAIL"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <comment>Added MISSING_EMAIL error cause argument values</comment>
    </changeSet>
    <changeSet id="12" author="ehub" dbms="oracle">
        <insert tableName="ERROR_C_A_V_TEXT_BUNDLE">
            <column name="ID" value="1030"/>
            <column name="ERROR_CAUSE_ARGUMENT_VALUE_ID" value="17"/>
            <column name="TEXT" value="Patron has no registered email address"/>
            <column name="LANGUAGE_ID" value="en"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <insert tableName="ERROR_C_A_V_TEXT_BUNDLE">
            <column name="ID" value="1031"/>
            <column name="ERROR_CAUSE_ARGUMENT_VALUE_ID" value="17"/>
            <column name="TEXT" value="LÃ¥ntagare har ingen email adress"/>
            <column name="LANGUAGE_ID" value="sv"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <comment>Added text bundles to MISSING_EMAIL error cause argument values</comment>
    </changeSet>

    <changeSet id="13" author="ehub" dbms="oracle">
        <delete tableName="EHUB_LOAN">
            <where>content_provider_record_id is null</where>
        </delete>
        <addNotNullConstraint columnName="content_provider_record_id" tableName="EHUB_LOAN"/>
        <addColumn tableName="EHUB_LOAN">
            <column name="CONTENT_PROVIDER_ISSUE_ID" type="varchar2(255)"/>
        </addColumn>
        <comment>Modify EHUB_LOAN</comment>
    </changeSet>

    <changeSet id="14" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_PROVIDER">
            <column name="ID" value="10"/>
            <column name="LOAN_PER_PRODUCT" value="1"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
            <column name="NAME" value="ZINIO"/>
        </insert>
        <comment>Added Zinio as Content Provider</comment>
    </changeSet>

    <changeSet id="15" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_PROVIDER_ALIAS">
            <column name="ID" value="12"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
            <column name="ALIAS" value="ZINIO"/>
            <column name="NAME" value="ZINIO"/>
        </insert>
        <comment>Added Zinio as ZINIO alias</comment>
    </changeSet>

    <changeSet id="16" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_PROVIDER_PROPERTY">
            <column name="CONTENT_PROVIDER_ID" value="10"/>
            <column name="PROPERTY_KEY" value="API_BASE_URL"/>
            <column name="PROPERTY_VALUE" value="http://www.rbdigitaltest.com"/>
        </insert>
        <insert tableName="CONTENT_PROVIDER_PROPERTY">
            <column name="CONTENT_PROVIDER_ID" value="10"/>
            <column name="PROPERTY_KEY" value="LOAN_EXPIRATION_DAYS"/>
            <column name="PROPERTY_VALUE" value="28"/>
        </insert>
        <comment>Added Zinio Content Provider properties</comment>
    </changeSet>

    <changeSet id="17" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_P_CONSUMER_P_KEY">
            <column name="PROPERTY_KEY" value="ZINIO_LIB_ID"/>
        </insert>
        <insert tableName="CONTENT_P_CONSUMER_P_KEY">
            <column name="PROPERTY_KEY" value="ZINIO_TOKEN"/>
        </insert>
        <comment>Added Zinio Content Provider Consumer property keys</comment>
    </changeSet>

    <changeSet id="18" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_P_FORMAT_DECORATION">
            <column name="ID" value="1801"/>
            <column name="CONTENT_DISPOSITION" value="STREAMING"/>
            <column name="FORMAT_ID" value="ZINIO.stream"/>
            <column name="CONTENT_PROVIDER_ID" value="10"/>
            <column name="LOCKED" value="0"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <comment>Added Zinio format decorations</comment>
    </changeSet>

    <changeSet id="19" author="ehub" dbms="oracle">
        <insert tableName="CONTENT_P_FORMAT_TEXT_BUNDLE">
            <column name="ID" value="4801"/>
            <column name="DESCRIPTION" value="Zinio streaming format"/>
            <column name="LANGUAGE_ID" value="en"/>
            <column name="NAME" value="Zinio (Stream)"/>
            <column name="CONTENT_P_FORMAT_DECORATION_ID" value="1801"/>
            <column name="CREATE_DATETIME" valueComputed="${now}"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
        </insert>
        <comment>Added text bundles to the Zinio format decorations</comment>
    </changeSet>

    <changeSet id="20" author="ehub" dbms="oracle">
        <update tableName="CONTENT_PROVIDER">
            <column name="LOAN_PER_PRODUCT" value="1"/>
            <column name="MODIFY_DATETIME" valueComputed="${now}"/>
            <where>ID=6</where>
        </update>
        <comment>Set loan per product for ELIB3</comment>
    </changeSet>
</databaseChangeLog>